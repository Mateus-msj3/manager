<p-toast></p-toast>

<!-- HEADER --->
<div class="grid p-fluid title">
  <div class="p-fluid col-12 md:col-8">
    <h2 class="">Filtro de Setor</h2>
  </div>

  <div class="p-fluid col-12 md:col-4">
    <div class="">
      <p-button class="button" label="Filtrar" icon="pi pi-search" iconPos="right" (click)="filter()"></p-button>
    </div>
  </div>
</div>

<!-- MAIN --->
<div class="grid p-fluid">

  <div class="p-fluid col-12 md:col-12">

    <div class="p-inputgroup">
      <span class="p-float-label">
        <input class="input" id="float-input13" type="text" pInputText [(ngModel)]="filterSector.name" name="name">
        <label for="float-input13">Nome</label>
      </span>
    </div>

  </div>

  <div class="p-fluid col-12 md:col-4">
    <div>
      <p-dropdown [options]="offices" [(ngModel)]="selectedOffice" optionLabel="name" [filter]="true" filterBy="name"
                  [showClear]="true" placeholder="Selecione o cargo" class="label-data">
        <ng-template pTemplate="selectedItem">
          <div class="country-item country-item-value" *ngIf="selectedOffice">
            <div>{{selectedOffice.name}}</div>
          </div>
        </ng-template>
        <ng-template>
          <div class="country-item">
            <div>{{selectedOffice.name}}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
  </div>

  <div class="p-fluid col-12 md:col-8">
    <div class="radio">
      <label class="label-radio">Status:</label>
      <p-radioButton name="situation" [value]="isAtivo" label="Ativo" [(ngModel)]="filterSector.situation"
                     class="radio-button"></p-radioButton>
      <p-radioButton name="situation" [value]="isInativo" label="Inativo" [(ngModel)]="filterSector.situation"
                     class="radio-button"></p-radioButton>
    </div>

  </div>


  <!-- TABLE GRID --->

  <div class="card p-fluid col-12 md:col-12">

    <p-table #dt [value]="sectors" [rows]="3" [paginator]="true"
             [globalFilterFields]="['name','country.name','representative.name','status']" responsiveLayout="scroll"
             [(selection)]="selectedSectors" [rowHover]="true" dataKey="id"
             currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
             [showCurrentPageReport]="true">
      <ng-template pTemplate="caption">
        <div class="flex align-items-center justify-content-between">
          <h5 class="m-0">Lista de Setores</h5>
          <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt.filterGlobal($event.target, 'contains')"
                           placeholder="Search..."/>
                </span>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">Nome
            <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th pSortableColumn="initDate">Data de Inicio
            <p-sortIcon field="initDate"></p-sortIcon>
          </th>
          <th pSortableColumn="situation">Situação
            <p-sortIcon field="situation"></p-sortIcon>
          </th>
          <th pSortableColumn="situation">Opções</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-sector>
        <tr>
          <td>{{sector.name}}</td>
          <td>{{sector.initDate | date: 'dd/MM/yyyy' }}</td>
          <td>{{sector.situation}}</td>
          <td>
            <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2"
                    (click)="editSector(sector)"></button>
            <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning mr-2"
                    (click)="deleteSector(sector)"></button>
            <button pButton pRipple icon="pi pi-eye" class="p-button-rounded p-button-secondary"
                    (click)="findOfficies(sector)"></button>
          </td>
                                                    <!-- DIALOG DE EDIÇÃO -->
          <p-dialog header="Detalhes do Setor"
                    [(visible)]="sectorDialog"
                    [style]="{width: '1300px', height: '1400px'}"
                    [maximizable]="true"
                    [resizable]="true"
                    [responsive]="true"
                    [modal]="true"
                    styleClass="p-fluid">
            <ng-template pTemplate="content">
              <app-form-sector [isEditMode]="true" [sector]="sector"></app-form-sector>
            </ng-template>

<!--            <ng-template pTemplate="footer">-->
<!--              <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"-->
<!--                      (click)="hideDialogSector()"></button>-->
<!--              <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="saveSector()"></button>-->
<!--            </ng-template>-->
          </p-dialog>

        </tr>
      </ng-template>
      <ng-template pTemplate="summary">
        <div class="flex align-items-center justify-content-between">
          No total existe {{sectors ? sectors.length : 0 }} setores.
        </div>
      </ng-template>
    </p-table>
  </div>

  <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>


  <!-- TABLE GRID OFFICE --->
  <p-dialog [(visible)]="hideTableGridOffice" [style]="{width: '1300px', height: '1400px'}" header="Detalhes do cargo"
            [modal]="true"
            [maximizable]="true" [draggable]="true" [resizable]="true" [breakpoints]="{'375px': '75vw'}">
    <ng-template pTemplate="content">
      <div class="card">

        <p-table #dt [value]="officesBySector" [rows]="3" [paginator]="true"
                 [globalFilterFields]="['name','country.name','representative.name','status']" responsiveLayout="scroll"
                 [(selection)]="selectedSectors" [rowHover]="true" dataKey="id"
                 currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                 editMode="row"
                 [showCurrentPageReport]="true">
          <ng-template pTemplate="caption">
            <div class="flex align-items-center justify-content-between">
              <h5 class="m-0">Lista de Setores</h5>
              <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt.filterGlobal($event.target, 'contains')"
                           placeholder="Search..."/>
                </span>
            </div>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name">Nome
                <p-sortIcon field="name"></p-sortIcon>
              </th>
              <th pSortableColumn="initDate">Salário Minimo
                <p-sortIcon field="initDate"></p-sortIcon>
              </th>
              <th pSortableColumn="situation">Salário Máximo
                <p-sortIcon field="situation"></p-sortIcon>
              </th>
              <th style="width:8rem"></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-office let-editing="editing" let-ri="rowIndex">
            <tr [pEditableRow]="office">
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText type="text" [(ngModel)]="office.name">
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{office.name}}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText type="text" [(ngModel)]="office.minimumSalaryRange" required>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{office.minimumSalaryRange | currency : 'R$'}}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText type="text" [(ngModel)]="office.maximumSalaryRange" required>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{office.maximumSalaryRange | currency : 'R$'}}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td style="text-align:center">
                <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                        (click)="onRowEditInit(office)" class="p-button-rounded p-button-text"></button>
                <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check"
                        (click)="onRowEditSave(office)"
                        class="p-button-rounded p-button-text p-button-success mr-2"></button>
                <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times"
                        (click)="onRowEditCancel(office, ri)"
                        class="p-button-rounded p-button-text p-button-danger"></button>
              </td>
            </tr>
          </ng-template>

        </p-table>
      </div>
    </ng-template>
  </p-dialog>

</div>
